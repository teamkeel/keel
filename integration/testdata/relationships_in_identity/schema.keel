model Account {
    fields {
        username Text @unique
        identity Identity @unique
        following Follow[]
        //   tweets Tweet[]
    }

    actions {
        create newAccount() with (username) {
            @set(account.identity = ctx.identity)
        }
        list accountsNotFollowing() {
            @where(account.identity not in ctx.identity.following.follower.identity)
            @where(account.identity != ctx.identity)
        }
        list accountsFollowing() {
            @where(ctx.identity in account.following.follower.identity)
        }
    }

    @permission(
        expression: ctx.isAuthenticated,
        actions: [get, list, create, update]
    )
}

model Follow {
    fields {
        follower Account
        account Account @relation(following)
    }

    actions {
        create follow() with (account.id, follower.id)
    }

    @unique([follower, account])

    @permission(
        expression: true,
        actions: [get, list, create, update]
    )
}

api Web {
    models {
        Account
        Follow
    }
}
