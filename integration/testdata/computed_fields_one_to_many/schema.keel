model Invoice {
    fields {
        items Item[]
        shipping Number 
        hasItems Boolean @computed(COUNTIF(invoice.items, invoice.items.isDeleted == false) > 0)
        total Decimal @computed(SUM(invoice.items.product.price) + invoice.shipping)
        numberOfItems Decimal @computed(COUNT(invoice.items.product))
        totalActive Decimal @computed(SUMIF(invoice.items.product.price, !invoice.items.isDeleted) + invoice.shipping)
        numberOfActiveItems Decimal @computed(COUNTIF(invoice.items.product.price, invoice.items.isDeleted == false && invoice.items.product.price > 0))
    }
    actions {
        get getInvoice(id) {
            @permission(expression: true)
        }
        create createInvoice() with (shipping, items.product.id?) {
            @permission(expression: true)
        }
        list listInvoices() {
            @permission(expression: true)
        }
    }
}

model Item {
    fields {
        invoice Invoice
        product Product
        isDeleted Boolean @default(false)
    }
    actions {
        get getItem(id) {
            @permission(expression: true)
        }
        create createItem() with (product.id, invoice.id) {
            @permission(expression: true)
        }
        update removeItem(id) {
            @set(item.isDeleted = true)
            @permission(expression: true)
        }
    }
}

model Product {
    fields {
        price Decimal
    }
    actions {
        get getProduct(id) {
            @permission(expression: true)
        }
        create createProduct() with (price) {
            @permission(expression: true)
        }
        list listProducts() {
            @permission(expression: true)
        }
    }
}
