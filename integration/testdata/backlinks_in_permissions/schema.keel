model User {
    fields {
        isAdult Boolean
        identity Identity @unique
    }

    actions {
        create createUser() with (isAdult, identity.id)
    }

    @permission(
        expression: true,
        actions: [get, list, create, update]
    )
}

model AdultFilm {
    fields {
        title Text @unique
    }

    actions {
        create createFilm() with (title)
        get getFilm(title) {
            @permission(expression: ctx.identity.user.isAdult)
        }
    }

    @permission(
        expression: true,
        actions: [get, list, create, update]
    )
}

model Admit {
    fields {
        film AdultFilm
        identity Identity
    }

    actions {
        create admit() with (film.id, identity.id) {
            @permission(expression: admit.identity.user.isAdult)
        }
    }
}
